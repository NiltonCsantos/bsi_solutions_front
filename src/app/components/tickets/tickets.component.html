<div class=" flex flex-col h-[75vh] w-[75vw] gap-5 overflow-y-scroll relative">

  <app-legends routerLink="solicitar" title="Chamados" textButton="Cadastrar" pathRoute="solicitar"
    *hasPermission="[profile.ROLE_EMPRESA]" />

  <table class="w-full bg-white shadow-xl  h-full  overflow-y-scroll">
    <thead class="w-full relative">
      <tr class="flex justify-between items-center px-10 rounded-md w-full  pt-8">
        <th class="text-left font-semibold text-sm text-[#045AFF] w-32 ">Título</th>
        <th class="text-left font-semibold text-sm text-[#045AFF] w-36 ">Aberto em</th>
        <th class="text-left font-semibold text-sm text-[#045AFF] w-32 ">Status</th>
        <th class="text-left font-semibold text-sm text-[#045AFF] w-32" *hasPermission="[profile.ROLE_EMPRESA]">Editar
        </th>
        <th class="text-left font-semibold text-sm text-[#045AFF] w-32">Acompanhar</th>

        <th class="text-left font-semibold text-sm w-32 absolute right-0 pl-15">
          <button (click)="this.getTicket()" class="cursor-pointer">
            <i class="fa-solid fa-arrows-rotate text-sm"></i>
          </button>

        </th>
      </tr>

    </thead>
    <tbody>
      @for (ticket of tickets; track $index) {
      <tr class="flex justify-between items-center py-2 px-10">

        <td class="text-left text-sm w-32">{{ticket.chaTxTitulo}}</td>
        <td class="text-left text-sm w-36">{{ticket.chaTxDtAbertura! | converDate }}</td>
        <td class=" text-sm w-32 px-2 relative" (mouseenter)="hoveredIndex = $index" (mouseleave)="hoveredIndex = null">
          <div class="w-6 h-6 rounded-full " [ngStyle]="{ 'background-color': getStatus(ticket.chaTxStatus!)
          }">

            <div class="absolute right-5 top-0  p-1 rounded-md text-white    animate-[popIn_0.40s_ease-out_forwards]"
              [ngStyle]="{ 'background-color': getStatus(ticket.chaTxStatus!)}"
              [ngClass]="{'hidden': hoveredIndex !== $index}">
              <p class="text-sm">
                {{ticket.chaTxStatus}}
              </p>
            </div>
          </div>
        </td>

        <td class="text-left text-sm w-32 px-3" *hasPermission="[profile.ROLE_EMPRESA]">
          <a [routerLink]="['solicitar', ticket.chaNrId]">
            <i class="fa-regular fa-pen-to-square text-xl cursor-pointer"></i>
          </a>
        </td>
        <td class="text-left text-sm w-32">
          <i class="fa-solid fa-eye text-xl cursor-pointer px-5"
          (click)="viewPopup(ticket.chaNrId!)"
          ></i>
        </td>
      </tr>
      }
    </tbody>
  </table>

  <div class="absolute h-full w-full flex justify-center items-center"
      [ngClass]="{'hidden':isPopupHidden}"
  >
    <div
    class=" transform w-[500px] rounded-md shadow-2xl bg-white h-[550px] overflow-scroll p-5 flex flex-col gap-5
    animate-[popIn_0.40s_ease-out_forwards]
    "
    >

    <div class="flex justify-between items-center">
      <h2 class="text-xl font-medium">
        Histórico
      </h2>
      <i class="fa-solid fa-xmark text-xl cursor-pointer"
      (click)="closePopup()"
      ></i>
    </div>

    <div class="flex gap-10 px-5 flex-wrap">
      <p>
        Empresa solicitante:
      </p>
      <p>
        {{ticketWithHistory?.empTxNome}}
      </p>
    </div>

    <div class="flex flex-col px-5 flex-wrap">
      <div class="flex gap-27">
        <div>
          <p>
            Chamado:
          </p>
          <p>
              {{ticketWithHistory?.chaTxTitulo}}
          </p>
        </div>
        <p>
            {{ticketWithHistory?.chaTxTitulo}}
        </p>
      </div>

    <div class="py-5">
      <p>
        Descrição:
      </p>
        <p >
          {{ticketWithHistory?.chaTxDescricao}}
      </p>
    </div>
    </div>

    <div class="px-5">
      <p>Lista</p>
    </div>

  </div>
  </div>


</div>
